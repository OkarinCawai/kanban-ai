<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trello Clone Milestone Dashboard</title>
    <style>
      :root {
        --bg-a: #f5efe3;
        --bg-b: #e7f0eb;
        --ink: #1b2a31;
        --muted: #5d6a70;
        --card: #ffffff;
        --border: #d2d9dd;
        --planned: #8a6f38;
        --in-progress: #1f7a6e;
        --completed: #14634c;
        --blocked: #a52a2a;
        --bar-bg: #e5eaed;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        color: var(--ink);
        font-family: "Trebuchet MS", "Segoe UI", sans-serif;
        background: linear-gradient(150deg, var(--bg-a), var(--bg-b));
      }

      .shell {
        max-width: 1200px;
        margin: 0 auto;
        padding: 28px 18px 36px;
      }

      .hero {
        background: #fff7e9;
        border: 2px solid #ccb585;
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 7px 18px rgba(49, 54, 59, 0.08);
      }

      .hero h1 {
        margin: 0 0 8px;
        letter-spacing: 0.2px;
      }

      .hero p {
        margin: 6px 0;
        color: var(--muted);
      }

      .stats {
        margin-top: 16px;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 10px;
      }

      .stat {
        background: #fff;
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 10px 12px;
      }

      .stat .label {
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.6px;
        color: var(--muted);
      }

      .stat .value {
        font-size: 24px;
        font-weight: 700;
        margin-top: 2px;
      }

      .board {
        margin-top: 18px;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 14px;
      }

      .milestone {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 14px;
        box-shadow: 0 5px 14px rgba(49, 54, 59, 0.06);
      }

      .milestone h3 {
        margin: 0 0 8px;
      }

      .milestone .meta {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        margin-bottom: 10px;
      }

      .badge {
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.6px;
        border-radius: 999px;
        border: 1px solid transparent;
        padding: 4px 8px;
      }

      .planned {
        color: var(--planned);
        background: #fff6df;
        border-color: #e8d19d;
      }

      .in-progress {
        color: var(--in-progress);
        background: #e5f6f2;
        border-color: #9ccfc3;
      }

      .completed {
        color: var(--completed);
        background: #e8f6ef;
        border-color: #8fcca8;
      }

      .blocked {
        color: var(--blocked);
        background: #fdecec;
        border-color: #e6abab;
      }

      .progress {
        margin: 10px 0 12px;
      }

      .progress-track {
        width: 100%;
        height: 10px;
        background: var(--bar-bg);
        border-radius: 999px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #1f7a6e, #2ea58f);
      }

      .progress-label {
        margin-top: 6px;
        font-size: 12px;
        color: var(--muted);
      }

      .tasks {
        margin: 0;
        padding-left: 18px;
      }

      .tasks li {
        margin-bottom: 5px;
        color: #314148;
      }

      .tasks li.done {
        color: #1b6f58;
      }

      .tasks li.done::marker {
        content: "x  ";
      }

      .tasks li.todo::marker {
        content: "-  ";
      }

      .hint {
        margin-top: 16px;
        font-size: 13px;
        color: var(--muted);
      }

      .updates {
        margin: 10px 0 0;
        padding-left: 18px;
        color: var(--muted);
        font-size: 13px;
      }

      .updates li {
        margin-bottom: 4px;
      }

      @media (max-width: 640px) {
        .stats {
          grid-template-columns: repeat(2, minmax(120px, 1fr));
        }
      }
    </style>
  </head>
  <body>
    <main class="shell">
      <section class="hero">
        <h1>Kanban Platform Milestone Dashboard</h1>
        <p>Source of truth: <code>docs/DEVELOPMENT_PLAN.md</code></p>
        <p>Last refreshed: <span id="lastRefreshed"></span></p>
        <p>Latest test verification: <span id="lastVerification"></span></p>
        <div class="stats">
          <div class="stat">
            <div class="label">Total Milestones</div>
            <div class="value" id="totalMilestones">0</div>
          </div>
          <div class="stat">
            <div class="label">Completed</div>
            <div class="value" id="completedMilestones">0</div>
          </div>
          <div class="stat">
            <div class="label">In Progress</div>
            <div class="value" id="activeMilestones">0</div>
          </div>
          <div class="stat">
            <div class="label">Blocked</div>
            <div class="value" id="blockedMilestones">0</div>
          </div>
          <div class="stat">
            <div class="label">Tests Passing</div>
            <div class="value" id="testsPassing">0</div>
          </div>
          <div class="stat">
            <div class="label">Tests Failing</div>
            <div class="value" id="testsFailing">0</div>
          </div>
        </div>
      </section>

      <section class="board" id="board"></section>

      <p class="hint">
        Update milestone data in the <code>MILESTONES</code> constant in this file as work progresses.
      </p>
    </main>

    <script>
      const MILESTONES = [
        {
          id: "M0",
          title: "Project Governance Setup",
          status: "completed",
          tasks: [
            { label: "Agent operating contract", done: true },
            { label: "Architecture and workflow docs", done: true },
            { label: "Milestone execution plan", done: true }
          ]
        },
        {
          id: "M1",
          title: "Core Kanban + Security Base",
          status: "completed",
          tasks: [
            { label: "Monorepo scaffold", done: true },
            { label: "Core schema + RLS policies", done: true },
            { label: "Board/List/Card CRUD", done: true },
            { label: "Web drag and drop board", done: true },
            { label: "Outbox write on mutations", done: true }
          ],
          updates: [
            "2026-02-10: Monorepo and package boundaries scaffolded.",
            "2026-02-10: API now runs against Supabase Postgres repository with transactional outbox writes.",
            "2026-02-10: Live Supabase RLS tests and API Supabase integration tests passing.",
            "2026-02-10: Supabase + Gemini environment configuration added.",
            "2026-02-10: Web board view with drag-and-drop move basics implemented."
          ]
        },
        {
          id: "M2",
          title: "Discord Auth + Core Commands",
          status: "completed",
          tasks: [
            { label: "API validates Supabase Bearer tokens", done: true },
            { label: "Supabase Discord provider setup", done: true },
            { label: "PKCE OAuth + callback code exchange", done: true },
            { label: "Session strategy across web/API", done: true },
            { label: "Connect identity command", done: true },
            { label: "My tasks / create / move commands", done: true }
          ],
          updates: [
            "2026-02-10: Direction updated to Supabase Auth Discord social login.",
            "2026-02-10: Auth contract aligned; M2 is unblocked and ready.",
            "2026-02-10: API accepts Authorization: Bearer <access_token> and resolves user id via Supabase Auth.",
            "2026-02-10: Web adds Supabase Discord sign-in and callback exchange; API calls can use the Supabase session token.",
            "2026-02-10: Discord interactions endpoint + API command bridge added (requires Discord app config + guild/channel mapping).",
            "2026-02-11: Added npm run verify:live to validate local liveness and M2 command path."
          ]
        },
        {
          id: "M3",
          title: "AI Summaries + Ask-the-Board",
          status: "completed",
          tasks: [
            { label: "Contracts for AI payloads + strict output schemas", done: true },
            { label: "Async API enqueue endpoints", done: true },
            { label: "Worker outbox poller scaffold (skip locked + retries)", done: true },
            { label: "RAG tables schema scaffold", done: true },
            { label: "Gemini adapter execution", done: true },
            { label: "Permission-aware retrieval", done: true },
            { label: "Grounded answer persistence + references", done: true },
            { label: "Embedding vector ranking upgrade", done: true },
            { label: "Async result retrieval API paths", done: true },
            { label: "Web/Discord polling integration", done: true }
          ],
          updates: [
            "2026-02-11: Added /cards/:cardId/summarize and /ai/ask-board enqueue endpoints.",
            "2026-02-11: Added ai.* outbox event contracts + core use-cases.",
            "2026-02-11: Added worker poller scaffold with FOR UPDATE SKIP LOCKED.",
            "2026-02-11: Added migration scaffold 0003_m3_ai_rag_scaffold.sql.",
            "2026-02-11: Worker now executes Gemini summary/ask jobs and persists grounded AI outputs with RLS-scoped retrieval.",
            "2026-02-11: Added Gemini embedding generation + cosine similarity retrieval with lexical fallback.",
            "2026-02-11: Added result status APIs for queued/completed AI jobs (`GET /cards/:cardId/summary`, `GET /ai/ask-board/:jobId`).",
            "2026-02-11: Web UI and Discord commands now poll async AI status and display completed summary/answer outputs."
          ]
        },
        {
          id: "M7",
          title: "Frontend UX Hardening for LLM Evaluation",
          status: "completed",
          tasks: [
            { label: "Brutalist frontend plan documented", done: true },
            { label: "Web board visual redesign (phase 0/1)", done: true },
            { label: "Unified AI async status UX", done: true },
            { label: "Desktop accessibility hardening", done: true },
            { label: "Mobile interaction hardening deferred (post full app readiness)", done: true }
          ],
          updates: [
            "2026-02-11: Added execution plan in docs/FRONTEND_BRUTALIST_PLAN.md.",
            "2026-02-11: Implementation started in apps/web with brutalist UI foundation and layout overhaul.",
            "2026-02-11: Prioritized as the current execution focus before M8/M4/M5/M6/M9.",
            "2026-02-11: Delivered new signal-room shell, ask-job tracker, diagnostics drawer, and unified async status chips for ask-board + card summaries.",
            "2026-02-11: Added desktop accessibility hardening: skip link, aria-live announcer, keyboard card actions, and aria-expanded toggle semantics.",
            "2026-02-11: M7 finalized as desktop-first; mobile interaction tuning deferred by product priority."
          ]
        },
        {
          id: "M8",
          title: "Card Enrichment (Trello-Style Details + Badges)",
          status: "completed",
          tasks: [
            { label: "Kickoff after M7 completion", done: true },
            { label: "Card details editing (description, assignees, dates, location, checklist, labels)", done: true },
            { label: "Board card metadata badges (due/checklist/comments/attachments/assignees/labels)", done: true },
            { label: "Contracts + core use-cases for enriched card fields", done: true },
            { label: "Schema migration + RLS policy coverage for new fields/tables", done: true },
            { label: "API + Discord adapter paths for enriched card mutations", done: true },
            { label: "Domain/API/RLS coverage incl live Supabase migration verification", done: true }
          ],
          updates: [
            "2026-02-11: Planned from Trello reference UX to support fully populated card details and glanceable card badges.",
            "2026-02-11: Scheduled to execute immediately after M7.",
            "2026-02-11: M8 execution started.",
            "2026-02-11: Added card detail editor UI and board metadata badges in apps/web/public.",
            "2026-02-11: Added contract/core/repository support + migration 0004_m8_card_enrichment.sql.",
            "2026-02-11: Added Discord adapter mutation path for enriched updates (`/card edit` -> `/discord/commands/card-edit`).",
            "2026-02-11: API Supabase e2e now skips until migration 0004 is applied in the target database.",
            "2026-02-12: Applied migration 0004 on Supabase and verified M8 gate with passing API Supabase e2e + policy live tests."
          ]
        },
        {
          id: "M4",
          title: "Thread to Card",
          status: "completed",
          tasks: [
            { label: "Thread fetch and extraction", done: true },
            { label: "Preview embed and action buttons", done: true },
            { label: "Create card/checklist assignment flow", done: true },
            { label: "Live Discord interactions verification", done: true }
          ],
          updates: [
            "2026-02-11: Sequenced after M7 and M8.",
            "2026-02-12: Added contract/core/repository + migration support for thread extraction lifecycle.",
            "2026-02-12: Worker now processes ai.thread-to-card.requested with strict draft extraction and retry-safe status updates.",
            "2026-02-12: Discord now supports /thread to-card preview with confirm action button and idempotent card creation.",
            "2026-02-12: verify:live now validates M4 bridge flow end-to-end (queue, completion, confirm, idempotency)."
          ]
        },
	        {
	          id: "M5",
	          title: "Deterministic Card Covers",
	          status: "completed",
	          tasks: [
	            { label: "CoverSpec contracts", done: true },
	            { label: "Spec generation job", done: true },
	            { label: "Deterministic PNG rendering and storage", done: true },
	            { label: "Web + Discord cover display", done: true }
	          ],
	          updates: [
	            "2026-02-11: Sequenced after M4.",
	            "2026-02-12: Added contracts + migration 0006 + core use-cases + worker outbox handlers for deterministic cover pipeline.",
	            "2026-02-12: API returns cover status; web can queue/poll jobs and show signed cover previews when available.",
	            "2026-02-12: Discord now supports /card cover + /card cover-status with embed image previews via signed cover URLs.",
	            "2026-02-12: verify:live now validates cover bucket provisioning, queue/status lifecycle, and signed URL fetch (HTTP 200)."
	          ]
	        },
	        {
	          id: "M6",
	          title: "Hygiene + Digests",
	          status: "completed",
	          tasks: [
	            { label: "Stuck-card detection", done: true },
	            { label: "Weekly recap generation", done: true },
	            { label: "Optional standup output", done: true }
	          ],
	          updates: [
	            "2026-02-11: Sequenced after M5.",
	            "2026-02-12: Added migration 0007 + core use-cases + worker handlers for stuck detection and weekly recaps.",
	            "2026-02-12: verify:live now validates M6 queue + completion end-to-end.",
	            "2026-02-12: Daily standup output wired end-to-end (API, worker handler, and verification)."
	          ]
	        },
	        {
	          id: "M9",
	          title: "Ask-AI Evaluation Granularity + Quality Gates",
	          status: "completed",
	          tasks: [
	            { label: "Curated fixture boards + deterministic question set", done: true },
	            { label: "Scenario matrix for enqueue/lifecycle/grounding/negative cases", done: true },
	            { label: "Permission-boundary (RLS leakage) evaluation suite", done: true },
	            { label: "Fallback + retry-idempotency checks", done: true },
	            { label: "Web/Discord async UX gate checks (queued/failed/completed)", done: true },
	            { label: "Run-report output with gate-level pass/fail summary", done: true }
	          ],
		          updates: [
		            "2026-02-11: Added granular ask-AI test milestone and linked plan in docs/ASK_AI_EVAL_PLAN.md.",
		            "2026-02-12: Sequenced after M6 and before adding new AI feature milestones (board generation, agents).",
		            "2026-02-12: Added eval runner (npm run eval:ask-ai) with seeded fixtures, grounding checks, denial checks, prompt-injection check, and Discord bridge parity."
		          ]
		        },
			        {
			          id: "M10",
			          title: "Web React Migration",
			          status: "completed",
			          tasks: [
			            { label: "Scaffold apps/web-react (React + TypeScript)", done: true },
			            { label: "Port board canvas to React with optimistic moves", done: true },
			            { label: "Adopt TanStack Query + @hello-pangea/dnd", done: true },
			            { label: "Incremental cutover with parity checklist + verify suite", done: true }
			          ],
			          updates: [
			            "2026-02-12: Planned incremental migration: scaffold apps/web-react first, then cut over once parity is reached.",
			            "2026-02-12: Keep contracts-first payloads; React becomes the UI foundation for later UX features.",
			            "2026-02-13: Scaffolded apps/web-react with React + TS (webpack build/dev), ported board flows + DnD + optimistic moves, and wired async AI surfaces + parity checklist.",
			            "2026-02-13: Updated dev stack + live verification to optionally probe apps/web-react for incremental cutover."
			          ]
			        },
		        {
		          id: "M11",
		          title: "Search + Discovery",
		          status: "completed",
		          tasks: [
		            { label: "Postgres FTS (tsvector + GIN) over cards", done: true },
		            { label: "Scoped search API endpoint (RLS-safe)", done: true },
		            { label: "Web search UI with jump-to-card", done: true },
		            { label: "Optional semantic search via worker jobs (embeddings)", done: true }
		          ],
		          updates: [
		            "2026-02-12: Planned: ship keyword search first with fast indexes and denial-case coverage.",
		            "2026-02-12: Semantic search is optional and gated behind stable embedding jobs/tests.",
		            "2026-02-13: Shipped board-scoped card search (FTS) with labels indexed + API + web-react UI.",
		            "2026-02-13: Added async semantic card search (queue + status) with RLS-safe retrieval."
		          ]
		        },
		        {
		          id: "M12",
		          title: "Generative Board Creation",
		          status: "completed",
		          tasks: [
		            { label: "BoardBlueprint contract + strict validation", done: true },
		            { label: "Async queue/status endpoints (outbox)", done: true },
		            { label: "Preview + confirm transactional creation flow", done: true },
		            { label: "Idempotency keys and retry-safe worker implementation", done: true }
		          ],
		          updates: [
		            "2026-02-12: Planned: solve the blank-canvas problem with async, schema-validated board generation.",
		            "2026-02-13: Implemented async board blueprint generation + preview/confirm flow with idempotent creation."
		          ]
		        },
		        {
		          id: "M13",
		          title: "Rich Text Descriptions",
		          status: "planned",
		          tasks: [
		            { label: "Tiptap editor integration (React)", done: false },
		            { label: "Durable storage format (JSONB) + safe rendering", done: false },
		            { label: "Keep checklists as structured data", done: false },
		            { label: "FTS indexing over rendered plain text", done: false }
		          ],
		          updates: [
		            "2026-02-12: Planned: rich text for descriptions only; checklist semantics stay structured and queryable."
		          ]
		        },
		        {
		          id: "M14",
		          title: "Realtime Collaboration + Presence",
		          status: "planned",
		          tasks: [
		            { label: "RLS-safe realtime strategy (events table vs postgres_changes)", done: false },
		            { label: "Board-scoped sync in web client with fallback", done: false },
		            { label: "Presence (who is here) UI", done: false },
		            { label: "Conflict UX aligned with version-based writes", done: false }
		          ],
		          updates: [
		            "2026-02-12: Planned post-v1: realtime is additive and must not weaken RLS guarantees."
		          ]
		        },
		        {
		          id: "M15",
		          title: "Intelligent Agents (Suggestion-first)",
		          status: "planned",
		          tasks: [
		            { label: "Auto-triage suggestions on card creation", done: false },
		            { label: "\"Break down with AI\" checklist proposals", done: false },
		            { label: "User-apply actions (no silent mutations)", done: false },
		            { label: "Idempotent, retry-safe worker jobs", done: false }
		          ],
		          updates: [
		            "2026-02-12: Planned post-v1: agents produce suggestions first, with explicit user acceptance."
		          ]
		        }
	      ];

      const TEST_SIGNAL = {
        passing: 70,
        failing: 0,
        verifiedAt: "2026-02-13 (latest full npm test + typecheck)"
      };

      const boardEl = document.getElementById("board");
      const totals = {
        total: MILESTONES.length,
        completed: 0,
        active: 0,
        blocked: 0
      };

      for (const milestone of MILESTONES) {
        const doneCount = milestone.tasks.filter((task) => task.done).length;
        const totalCount = milestone.tasks.length || 1;
        const progress = Math.round((doneCount / totalCount) * 100);

        if (milestone.status === "completed") totals.completed += 1;
        if (milestone.status === "in-progress") totals.active += 1;
        if (milestone.status === "blocked") totals.blocked += 1;

        const card = document.createElement("article");
        card.className = "milestone";
        card.innerHTML = `
          <h3>${milestone.id} - ${milestone.title}</h3>
          <div class="meta">
            <span class="badge ${milestone.status}">${milestone.status.replace("-", " ")}</span>
            <span>${doneCount}/${totalCount} tasks</span>
          </div>
          <div class="progress">
            <div class="progress-track">
              <div class="progress-fill" style="width: ${progress}%"></div>
            </div>
            <div class="progress-label">${progress}% complete</div>
          </div>
          <ul class="tasks">
            ${milestone.tasks
              .map(
                (task) =>
                  `<li class="${task.done ? "done" : "todo"}">${task.label}</li>`
              )
              .join("")}
          </ul>
          ${
            milestone.updates && milestone.updates.length
              ? `<ul class="updates">${milestone.updates.map((item) => `<li>${item}</li>`).join("")}</ul>`
              : ""
          }
        `;
        boardEl.appendChild(card);
      }

      document.getElementById("totalMilestones").textContent = totals.total;
      document.getElementById("completedMilestones").textContent = totals.completed;
      document.getElementById("activeMilestones").textContent = totals.active;
      document.getElementById("blockedMilestones").textContent = totals.blocked;
      document.getElementById("testsPassing").textContent = String(TEST_SIGNAL.passing);
      document.getElementById("testsFailing").textContent = String(TEST_SIGNAL.failing);
      document.getElementById("lastVerification").textContent = TEST_SIGNAL.verifiedAt;
      document.getElementById("lastRefreshed").textContent =
        new Date().toLocaleString();
    </script>
  </body>
</html>
